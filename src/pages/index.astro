---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
// import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import getSortedPosts from "@/utils/getSortedPosts";
// import IconRss from "@/assets/icons/IconRss.svg";
// import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
// import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
// const recentPosts = sortedPosts.filter(({ data }) => !data.featured);

// const chunk = (arr: unknown[], num = 2) => Array.from({length: Math.ceil(arr.length / num)}, (_, i) => arr.slice(i * 2, i * 2 + 2));
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index" class="app-layout">
    <section id="hero" class:list={["pt-8 pb-6", "border-b border-border"]}>
      <h1 class="my-4 inline-block text-4xl font-bold sm:my-8 sm:text-5xl">
        Dražen Buljovčić
      </h1>

      <p class:list={["text-3xl", "mb-2"]}>Software Engineer</p>

      <div class:list={["mt-5"]}>
        {
          // only display if at least one social link is enabled
          SOCIALS.length > 0 && (
            <div class="mt-4 flex max-sm:flex-col sm:items-center">
              <Socials />
            </div>
          )
        }
      </div>
    </section>

    <section id="portfolio" class="pt-8 pb-6">
      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
        <div
          class="rounded-lg border border-border p-6 transition-colors hover:border-accent"
        >
          <h3 class="mb-2 text-xl font-semibold">Web Sites</h3>
          <p class="text-">
            Creating responsive, performant websites with modern frameworks and
            best practices.
          </p>
        </div>

        <div
          class="rounded-lg border border-border p-6 transition-colors hover:border-accent"
        >
          <h3 class="mb-2 text-xl font-semibold">Web Applications</h3>
          <p>
            Building full-stack web applications with focus on user experience
            and usability.
          </p>
        </div>

        <div
          class="rounded-lg border border-border p-6 transition-colors hover:border-accent"
        >
          <h3 class="mb-2 text-xl font-semibold">Platform Engineering</h3>
          <p>
            Designing and implementing CI/CD pipelines, cloud infrastructure,
            and developer tools.
          </p>
        </div>

        <div
          class="rounded-lg border border-border p-6 transition-colors hover:border-accent"
        >
          <h3 class="mb-2 text-xl font-semibold">Developer Experience</h3>
          <p>
            Owning large scale decisions that impact on the developer workflow
            apparent and tackled for efficient release cadence. Plus
            observability.
          </p>
        </div>

        <div
          class="rounded-lg border border-border p-6 transition-colors hover:border-accent"
        >
          <h3 class="mb-2 text-xl font-semibold">Harness Engineering</h3>
          <p>Elevating Engineering using Agentic development practices.</p>
        </div>

        <div
          class="rounded-lg border border-border p-6 transition-colors hover:border-accent"
        >
          <h3 class="mb-2 text-xl font-semibold">Software Architecture</h3>
          <p>
            Designing scalable, maintainable system architectures and
            microservices.
          </p>
        </div>
      </div>
    </section>

    {
      featuredPosts.length > 0 && (
        <section id="featured" class:list={["pt-12 pb-6"]}>
          <h2 class="border-border pb-0.5 text-center text-2xl font-semibold tracking-wide">
            What I've been up to
          </h2>
          <ul>
            {featuredPosts.map(data => (
              <Card variant="h3" {...data} />
            ))}
          </ul>
        </section>
      )
    }

    <!-- {
      recentPosts.length > 0 && (
        <section id="recent-posts" class="pt-12 pb-6">
          <h2 class="text-2xl font-semibold tracking-wide">Recent Posts</h2>
          <ul>
            {recentPosts.map(
              (data, index) =>
                index < SITE.postPerIndex && <Card variant="h3" {...data} />
            )}
          </ul>
        </section>
      )
    } -->

    <!-- <div class="my-8 text-center">
      <LinkButton href="/posts/">
        All Posts
        <IconArrowRight class="inline-block rtl:-rotate-180" />
      </LinkButton>
    </div> -->
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
